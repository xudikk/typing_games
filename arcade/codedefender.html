<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kod Himoyachisi</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap">
  <style>
    :root {
      --primary: #6d28d9; /* Neon binafsha */
      --secondary: #f472b6; /* Neon pushti */
      --accent: #4ade80; /* Neon yashil */
      --health: #ef4444; /* Qizil HP */
      --mana: #3b82f6; /* Ko‚Äòk mana */
      --text: #f0f9ff; /* Oq rang matn uchun */
      --bg-dark: #0f172a; /* Quyuk ko‚Äòk fon */
      --bg-card: rgba(30, 41, 59, 0.8); /* Karta foni */
      --console-skill: #facc15; /* Sariq skill xabarlari */
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e1b4b, #2e1065);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .hero-background {
      position: relative;
      width: 100%;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .starfield {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: radial-gradient(1.5px 1.5px at 15px 25px, var(--accent) 1px, transparent 0),
                       radial-gradient(1px 1px at 40px 50px, var(--secondary) 1px, transparent 0),
                       radial-gradient(1.2px 1.2px at 70px 80px, var(--text) 1px, transparent 0);
      background-size: 100px 100px;
      background-repeat: repeat;
      animation: twinkle 5s linear infinite;
      z-index: 1;
    }

    @keyframes twinkle {
      0% { transform: translate(0, 0); opacity: 0.7; }
      100% { transform: translate(-30px, -30px); opacity: 0.7; }
    }

    .floating-elements {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
    }

    .floating-icon {
      position: absolute;
      font-size: 1.4rem;
      color: var(--accent);
      opacity: 0.6;
      animation: float 4s ease-in-out infinite;
      animation-delay: var(--delay, 0s);
    }

    .floating-icon:nth-child(1) { top: 15%; left: 10%; --delay: 0s; }
    .floating-icon:nth-child(2) { top: 45%; right: 8%; --delay: 0.8s; }
    .floating-icon:nth-child(3) { top: 30%; right: 25%; --delay: 0.4s; }
    .floating-icon:nth-child(4) { bottom: 20%; left: 15%; --delay: 1.2s; }
    .floating-icon:nth-child(5) { bottom: 15%; left: 50%; --delay: 1.6s; }

    @keyframes float {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-15px) scale(1.1); }
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      background: linear-gradient(45deg, #1e1b4b, #2e1065);
      box-shadow: 0 4px 15px rgba(109, 40, 217, 0.3);
      z-index: 4;
      animation: fadeIn 1s ease-out;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-icon {
      width: 40px;
      height: 40px;
      background: var(--secondary);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      font-size: 1.5rem;
      font-weight: 700;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    }

    .brand-icon:hover {
      transform: rotate(360deg) scale(1.1);
      box-shadow: 0 0 15px var(--secondary);
    }

    .brand-text {
      color: var(--accent);
      font-size: 1.6rem;
      font-weight: 700;
      text-shadow: 0 0 8px rgba(74, 222, 128, 0.6);
    }

    .nav-links {
      display: flex;
      gap: 12px;
    }

    .nav-btn {
      background: linear-gradient(45deg, var(--primary), #a855f7);
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .nav-btn a {
      color: var(--text);
      text-decoration: none;
      text-shadow: 0 0 5px rgba(74, 222, 128, 0.6);
      display: block;
    }

    .nav-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 15px rgba(109, 40, 217, 0.5);
    }

    .game-container {
      position: relative;
      z-index: 3;
      width: 100%;
      max-width: 1100px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(30, 27, 75, 0.9), rgba(46, 16, 101, 0.9));
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(109, 40, 217, 0.4);
      animation: fadeIn 1s ease-out;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .game-title {
      color: var(--accent);
      font-size: 2.8rem;
      font-weight: 700;
      margin-bottom: 20px;
      text-transform: uppercase;
      text-shadow: 0 0 12px rgba(74, 222, 128, 0.7);
      animation: glow 1.5s ease-in-out infinite alternate;
    }

    @keyframes glow {
      0% { text-shadow: 0 0 8px rgba(74, 222, 128, 0.7); }
      100% { text-shadow: 0 0 16px rgba(74, 222, 128, 0.9); }
    }

    .skills-bar {
      display: flex;
      gap: 10px;
      width: 100%;
      max-width: 800px;
      margin-bottom: 15px;
      justify-content: center;
    }

    .skill-card {
      background: var(--bg-card);
      border: 2px solid var(--accent);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 1rem;
      color: var(--accent);
      text-shadow: 0 0 6px rgba(74, 222, 128, 0.6);
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }

    .skill-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 12px rgba(74, 222, 128, 0.6);
    }

    .skill-card.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      border-color: #555;
    }

    .game-area {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 20px;
      margin: 20px 0;
    }

    .game-board {
      position: relative;
      width: 800px;
      height: 600px;
      background: var(--bg-dark);
      border: 4px solid var(--primary);
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(109, 40, 217, 0.5);
      overflow: hidden;
    }

    .side-panel {
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
      width: 200px;
    }

    .score-card, .health-card, .mana-card, .enemy-card, .input-card, .console-card {
      background: var(--bg-card);
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      width: 100%;
      text-align: center;
    }

    .console-card {
      height: 100px;
      overflow-y: auto;
      border: 2px solid var(--primary);
    }

    #consoleOutput {
      font-size: 0.9rem;
      color: var(--text);
      text-align: left;
      padding: 5px;
    }

    #consoleOutput .code-log { color: var(--accent); }
    #consoleOutput .damage-log { color: var(--health); }
    #consoleOutput .skill-log { color: var(--console-skill); }
    #consoleOutput .info-log { color: var(--text); }

    .code {
      position: absolute;
      color: var(--accent);
      font-size: 1.3rem;
      font-weight: 600;
      text-shadow: 0 0 8px rgba(74, 222, 128, 0.6);
      animation: pulse 1.5s ease-in-out infinite;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .virus {
      position: absolute;
      font-size: 1.8rem;
      color: var(--health);
      text-shadow: 0 0 8px rgba(255, 85, 85, 0.6);
      animation: moveToCenter linear;
    }

    .particle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: var(--health);
      border-radius: 50%;
      animation: particle 0.5s ease-out forwards;
    }

    .server {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3rem;
      color: var(--accent);
      text-shadow: 0 0 12px rgba(74, 222, 128, 0.8);
      animation: pulse 2s ease-in-out infinite, glow 2s ease-in-out infinite alternate;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes moveToCenter {
      0% { transform: translate(0, 0); }
      100% { transform: translate(var(--dx), var(--dy)); }
    }

    @keyframes particle {
      0% { opacity: 1; transform: scale(1) translate(0, 0); }
      100% { opacity: 0; transform: scale(0.5) translate(var(--dx), var(--dy)); }
    }

    #wordInput {
      padding: 14px;
      font-size: 1.3rem;
      height: 48px;
      width: 98%;
      max-width: 98%;
      border: 2px solid var(--primary);
      border-radius: 8px;
      background: #1e293b;
      color: var(--text);
      outline: none;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    #wordInput:focus {
      border-color: var(--accent);
      box-shadow: 0 0 12px rgba(74, 222, 128, 0.6);
    }

    #wordInput::placeholder {
      color: rgba(240, 249, 255, 0.6);
      transition: opacity 0.3s ease;
    }

    #wordInput:focus::placeholder {
      opacity: 0;
    }

    #scoreDisplay, #healthDisplay, #manaDisplay, #enemyTimer {
      font-size: 1.2rem;
      color: var(--accent);
      text-shadow: 0 0 6px rgba(74, 222, 128, 0.6);
    }

    #healthDisplay progress, #manaDisplay progress, #enemyTimer progress {
      width: 100%;
      height: 10px;
      border-radius: 5px;
      background: #1e293b;
    }

    #healthDisplay progress::-webkit-progress-bar, #manaDisplay progress::-webkit-progress-bar, #enemyTimer progress::-webkit-progress-bar {
      background: #1e293b;
      border-radius: 5px;
    }

    #healthDisplay progress::-webkit-progress-value {
      background: var(--health);
      border-radius: 5px;
    }

    #manaDisplay progress::-webkit-progress-value {
      background: var(--mana);
      border-radius: 5px;
    }

    #enemyTimer progress::-webkit-progress-value {
      background: var(--secondary);
      border-radius: 5px;
    }

    #restartButton {
      padding: 10px 20px;
      background: linear-gradient(45deg, var(--secondary), var(--accent));
      color: var(--text);
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
      display: none;
    }

    #restartButton:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 15px rgba(74, 222, 128, 0.6);
    }

    .footer {
      text-align: center;
      padding: 15px;
      background: linear-gradient(45deg, #1e1b4b, #2e1065);
      color: var(--text);
      font-size: 0.9rem;
      animation: fadeIn 1s ease-out;
    }

    .footer a {
      color: var(--accent);
      text-decoration: none;
      margin: 0 5px;
      transition: transform 0.3s ease;
    }

    .footer a:hover {
      transform: scale(1.1);
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .game-container { max-width: 90%; padding: 15px; }
      .game-title { font-size: 2.2rem; }
      .game-board { width: 700px; height: 500px; }
      .side-panel { width: 180px; }
      .code, .virus { font-size: 1.2rem; }
      .server { font-size: 2.5rem; }
      .skill-card { font-size: 0.9rem; padding: 6px 10px; }
      #wordInput { font-size: 1.2rem; height: 42px; }
      #scoreDisplay, #healthDisplay, #manaDisplay, #enemyTimer { font-size: 1.1rem; }
      #restartButton { font-size: 0.9rem; padding: 8px 16px; }
      .header { padding: 12px 18px; }
      .nav-btn { padding: 8px 16px; font-size: 1rem; }
      .brand-icon { width: 36px; height: 36px; font-size: 1.4rem; }
      .brand-text { font-size: 1.5rem; }
      .console-card { height: 80px; }
      #consoleOutput { font-size: 0.85rem; }
    }

    @media (max-width: 480px) {
      .game-container { max-width: 95%; padding: 12px; }
      .game-title { font-size: 1.8rem; }
      .game-board { width: 400px; height: 400px; }
      .side-panel { width: 100%; align-items: center; }
      .code, .virus { font-size: 1rem; }
      .server { font-size: 2rem; }
      .skill-card { font-size: 0.8rem; padding: 5px 8px; }
      #wordInput { font-size: 1.1rem; height: 38px; }
      #scoreDisplay, #healthDisplay, #manaDisplay, #enemyTimer { font-size: 1rem; }
      #restartButton { font-size: 0.8rem; padding: 6px 14px; }
      .header { padding: 10px 12px; }
      .nav-btn { padding: 6px 10px; font-size: 0.9rem; }
      .brand-icon { width: 32px; height: 32px; font-size: 1.2rem; }
      .brand-text { font-size: 1.3rem; }
      .game-area { flex-direction: column; align-items: center; }
      .skills-bar { flex-direction: column; align-items: center; }
      .console-card { height: 60px; }
      #consoleOutput { font-size: 0.8rem; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <div class="brand-icon">N</div>
      <span class="brand-text">NeoCoder</span>
    </div>
    <nav class="nav-links">
      <button class="nav-btn"><a href="../index.html">Bosh sahifa</a></button>
      <button class="nav-btn"><a href="../lessons.html">Darslar</a></button>
      <button class="nav-btn"><a href="../games.html">Arcade</a></button>
      <button class="nav-btn"><a href="../profile.html">Profil</a></button>
    </nav>
  </header>

  <div class="hero-background">
    <div class="starfield"></div>
    <div class="floating-elements">
      <div class="floating-icon">üñ•Ô∏è</div>
      <div class="floating-icon">ü¶†</div>
      <div class="floating-icon">üíæ</div>
      <div class="floating-icon">üîê</div>
      <div class="floating-icon">üêû</div>
    </div>
    <div class="game-container">
      <h2 class="game-title">Kod Himoyachisi</h2>
      <div class="skills-bar">
        <div class="skill-card" id="surgeSkill">Surge: 50 mana ‚ö°</div>
        <div class="skill-card" id="shieldBoostSkill">ShieldBoost: 100 mana üßô</div>
        <div class="skill-card" id="debugSkill">Debug: 30 mana üêû</div>
      </div>
      <div class="game-area">
        <div class="game-board" id="gameBoard">
          <div class="server">üñ•Ô∏è</div>
        </div>
        <div class="side-panel">
          <div class="score-card">
            <div id="scoreDisplay">Ochko: 0</div>
          </div>
          <div class="health-card">
            <div id="healthDisplay">HP: 100/100 <progress max="100" value="100"></progress></div>
          </div>
          <div class="mana-card">
            <div id="manaDisplay">Mana: 0/100 <progress max="100" value="0"></progress></div>
          </div>
          <div class="enemy-card">
            <div id="enemyTimer">Virus hujumi: <progress max="20" value="20"></progress></div>
          </div>
          <div class="input-card">
            <input type="text" id="wordInput" placeholder="Kodni kiriting" autocomplete="off">
          </div>
          <div class="input-card">
            <button id="restartButton">Qayta boshlash</button>
          </div>
        </div>
      </div>
      <div class="console-card">
        <div id="consoleOutput"></div>
      </div>
    </div>
  </div>

  <footer class="footer">
    ¬© 2025 NeoCoder | <a href="#">Terms</a> | <a href="#">Privacy</a>
  </footer>

  <script>
    const codes = [
      "print('Hello')", "if x > 0:", "def func():", "x += 1",
      "for i in range(10):", "while True:", "import math",
      "list = [1, 2, 3]", "try: x = 1", "except ValueError:",
      "class MyClass:", "with open('file.txt'):", "lambda x: x*2",
      "import random", "def add(a, b):"
    ];
    let activeCodes = [];
    let score = 0;
    let health = 100;
    let mana = 0;
    let enemyTimer = 20;
    let gameOver = false;
    let enemyInterval;
    let manaInterval;
    let codeCount = 0;
    let virusBlockedCount = 0;
    let skillUsedCount = { surge: 0, shieldBoost: 0, debug: 0 };
    const maxCodes = 50;
    const boardWidth = 800;
    const boardHeight = 600;
    const virusSpeed = 0.03; // piksellar/soniya
    let consoleLogs = [];

    function formatTime() {
      const now = new Date();
      return `[${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}]`;
    }

    function logToConsole(message, type = 'info') {
      const consoleOutput = document.getElementById('consoleOutput');
      if (!consoleOutput) return;
      consoleLogs.push({ message, type });
      consoleLogs = consoleLogs.slice(-50); // Maksimum 50 xabar
      consoleOutput.innerHTML = consoleLogs.map(log =>
        `<div class="${log.type}-log">${formatTime()} ${log.message}</div>`
      ).join('');
      consoleOutput.scrollTop = consoleOutput.scrollHeight; // Avtomatik scroll
    }

    function initializeGame() {
      activeCodes = [];
      score = 0;
      health = 100;
      mana = 0;
      enemyTimer = 20;
      codeCount = 0;
      virusBlockedCount = 0;
      skillUsedCount = { surge: 0, shieldBoost: 0, debug: 0 };
      consoleLogs = [];
      gameOver = false;
      const scoreDisplay = document.getElementById('scoreDisplay');
      const healthDisplay = document.getElementById('healthDisplay');
      const manaDisplay = document.getElementById('manaDisplay');
      const enemyTimerDisplay = document.getElementById('enemyTimer');
      const consoleOutput = document.getElementById('consoleOutput');
      const restartButton = document.getElementById('restartButton');
      if (scoreDisplay) scoreDisplay.innerHTML = 'Ochko: ' + score;
      if (healthDisplay) healthDisplay.innerHTML = `HP: ${health}/100 <progress max="100" value="${health}"></progress>`;
      if (manaDisplay) manaDisplay.innerHTML = `Mana: ${mana}/100 <progress max="100" value="${mana}"></progress>`;
      if (enemyTimerDisplay) enemyTimerDisplay.innerHTML = 'Virus hujumi: <progress max="20" value="20"></progress>';
      if (consoleOutput) consoleOutput.innerHTML = '';
      if (restartButton) restartButton.style.display = 'none';
      const gameBoard = document.getElementById('gameBoard');
      if (gameBoard) {
        gameBoard.innerHTML = '<div class="server">üñ•Ô∏è</div>';
      }
      updateSkillButtons();
      startCodeGeneration();
      startEnemyLoop();
      startManaRegeneration();
      logToConsole('O‚Äòyin boshlandi', 'info');
      const wordInput = document.getElementById('wordInput');
      if (wordInput) {
        setTimeout(() => {
          wordInput.focus();
        }, 100);
      }
    }

    function isPositionValid(x, y) {
      return activeCodes.every(code => {
        const codeX = parseFloat(code.style.left);
        const codeY = parseFloat(code.style.top);
        const distance = Math.sqrt((x - codeX) ** 2 + (y - codeY) ** 2);
        return distance > 50; // 50px masofa
      });
    }

    function createCode() {
      if (gameOver || activeCodes.length >= 5) return;
      const code = codes[Math.floor(Math.random() * codes.length)];
      const codeElement = document.createElement('div');
      codeElement.className = 'code';
      codeElement.innerHTML = `${code} <span>üêç</span>`;
      let x, y, attempts = 0;
      const maxAttempts = 10;
      const maxX = boardWidth - 150;
      const maxY = boardHeight - 30;
      do {
        x = Math.random() * maxX;
        y = Math.random() * maxY;
        attempts++;
      } while (!isPositionValid(x, y) && attempts < maxAttempts);
      if (attempts >= maxAttempts) return;
      codeElement.style.left = `${x}px`;
      codeElement.style.top = `${y}px`;
      codeElement.dataset.code = code;
      document.getElementById('gameBoard').appendChild(codeElement);
      activeCodes.push(codeElement);
      logToConsole(`Yangi kod: ${code}`, 'code');
    }

    function createParticles(x, y) {
      const particleCount = 8;
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;
        const angle = Math.random() * 2 * Math.PI;
        const distance = 20 + Math.random() * 30;
        particle.style.setProperty('--dx', `${Math.cos(angle) * distance}px`);
        particle.style.setProperty('--dy', `${Math.sin(angle) * distance}px`);
        document.getElementById('gameBoard').appendChild(particle);
        setTimeout(() => particle.remove(), 500);
      }
      playSound('explode');
    }

    function playSound(type) {
      const audio = new Audio();
      if (type === 'success') audio.src = 'https://cdn.pixabay.com/audio/2023/02/28/audio_4e5a696f62.mp3';
      else if (type === 'skill') audio.src = 'https://cdn.pixabay.com/audio/2024/03/29/audio_4f6b3b23b5.mp3';
      else if (type === 'explode') audio.src = 'https://cdn.pixabay.com/audio/2022/01/25/audio_d6c577e705.mp3';
      audio.play().catch(() => {}); // Xatolarni e'tiborsiz qoldirish
    }

    function useSurge() {
      if (gameOver || mana < 50) return;
      mana -= 50;
      activeCodes.forEach(code => {
        code.remove();
      });
      activeCodes = [];
      score += 20;
      skillUsedCount.surge++;
      updateScore();
      updateMana();
      playSound('skill');
      updateSkillButtons();
      logToConsole('Skill ishlatildi: Surge (‚ö°)', 'skill');
    }

    function useShieldBoost() {
      if (gameOver || mana < 100) return;
      mana -= 100;
      skillUsedCount.shieldBoost++;
      updateMana();
      playSound('skill');
      updateSkillButtons();
      logToConsole('Skill ishlatildi: ShieldBoost (üßô)', 'skill');
    }

    function useDebug() {
      if (gameOver || mana < 30) return;
      mana -= 30;
      health = Math.min(100, health + 10);
      skillUsedCount.debug++;
      updateHealth();
      updateMana();
      playSound('skill');
      updateSkillButtons();
      logToConsole('Skill ishlatildi: Debug (üêû)', 'skill');
    }

    function updateSkillButtons() {
      const surgeSkill = document.getElementById('surgeSkill');
      const shieldBoostSkill = document.getElementById('shieldBoostSkill');
      const debugSkill = document.getElementById('debugSkill');
      if (surgeSkill) {
        surgeSkill.classList.toggle('disabled', mana < 50 || gameOver);
      }
      if (shieldBoostSkill) {
        shieldBoostSkill.classList.toggle('disabled', mana < 100 || gameOver);
      }
      if (debugSkill) {
        debugSkill.classList.toggle('disabled', mana < 30 || gameOver);
      }
    }

    function checkCode() {
      const input = document.getElementById('wordInput');
      if (!input) return;
      const typedCode = input.value.trim();
      const matchedCode = activeCodes.find(code => code.dataset.code === typedCode);
      if (matchedCode) {
        input.value = '';
        score += 10;
        mana = Math.min(100, mana + 5);
        codeCount++;
        matchedCode.remove();
        activeCodes = activeCodes.filter(c => c !== matchedCode);
        updateScore();
        updateMana();
        playSound('success');
        updateSkillButtons();
        logToConsole(`Kod kiritildi: ${typedCode} (+10 ochko, +5 mana)`, 'code');
        if (codeCount >= maxCodes) {
          gameOver = true;
          stopEnemyLoop();
          stopManaRegeneration();
          logToConsole(`O‚Äòyin tugadi! Ochko: ${score}, Kiritilgan kodlar: ${codeCount}, To‚Äòxtatilgan viruslar: ${virusBlockedCount}, Ishlatilgan skillar: Surge (${skillUsedCount.surge}), ShieldBoost (${skillUsedCount.shieldBoost}), Debug (${skillUsedCount.debug})`, 'info');
          const restartButton = document.getElementById('restartButton');
          if (restartButton) restartButton.style.display = 'block';
        }
        setTimeout(() => {
          input.focus();
        }, 100);
      }
    }

    function updateScore() {
      const scoreDisplay = document.getElementById('scoreDisplay');
      if (scoreDisplay) scoreDisplay.innerHTML = 'Ochko: ' + score;
    }

    function updateHealth() {
      const healthDisplay = document.getElementById('healthDisplay');
      if (healthDisplay) healthDisplay.innerHTML = `HP: ${health}/100 <progress max="100" value="${health}"></progress>`;
      if (health <= 0) {
        gameOver = true;
        stopEnemyLoop();
        stopManaRegeneration();
        logToConsole(`O‚Äòyin tugadi! Ochko: ${score}, Kiritilgan kodlar: ${codeCount}, To‚Äòxtatilgan viruslar: ${virusBlockedCount}, Ishlatilgan skillar: Surge (${skillUsedCount.surge}), ShieldBoost (${skillUsedCount.shieldBoost}), Debug (${skillUsedCount.debug})`, 'info');
        const restartButton = document.getElementById('restartButton');
        if (restartButton) restartButton.style.display = 'block';
        updateSkillButtons();
      }
    }

    function updateMana() {
      const manaDisplay = document.getElementById('manaDisplay');
      if (manaDisplay) manaDisplay.innerHTML = `Mana: ${mana}/100 <progress max="100" value="${mana}"></progress>`;
      updateSkillButtons();
    }

    function startManaRegeneration() {
      if (!manaInterval) {
        manaInterval = setInterval(() => {
          if (!gameOver) {
            mana = Math.min(100, mana + 1);
            updateMana();
            logToConsole('Mana +1', 'info');
          }
        }, 2000);
      }
    }

    function stopManaRegeneration() {
      if (manaInterval) {
        clearInterval(manaInterval);
        manaInterval = null;
      }
    }

    function createVirus() {
      if (gameOver) return;
      const types = ['ü¶†', 'üíæ', 'üîê'];
      const damages = { 'ü¶†': 10, 'üíæ': 20, 'üîê': 15 };
      const type = types[Math.floor(Math.random() * types.length)];
      const virus = document.createElement('div');
      virus.className = 'virus';
      virus.innerHTML = type;
      const side = Math.floor(Math.random() * 4); // 0: top, 1: right, 2: bottom, 3: left
      let x, y, dx, dy;
      if (side === 0) { // Top
        x = Math.random() * boardWidth;
        y = 0;
        dx = (boardWidth / 2 - x);
        dy = (boardHeight / 2 - y);
      } else if (side === 1) { // Right
        x = boardWidth;
        y = Math.random() * boardHeight;
        dx = (boardWidth / 2 - x);
        dy = (boardHeight / 2 - y);
      } else if (side === 2) { // Bottom
        x = Math.random() * boardWidth;
        y = boardHeight;
        dx = (boardWidth / 2 - x);
        dy = (boardHeight / 2 - y);
      } else { // Left
        x = 0;
        y = Math.random() * boardHeight;
        dx = (boardWidth / 2 - x);
        dy = (boardHeight / 2 - y);
      }
      virus.style.left = `${x}px`;
      virus.style.top = `${y}px`;
      virus.style.setProperty('--dx', `${dx}px`);
      virus.style.setProperty('--dy', `${dy}px`);
      virus.dataset.startTime = Date.now();
      virus.dataset.type = type;
      document.getElementById('gameBoard').appendChild(virus);
      logToConsole(`Yangi virus: ${type}`, 'damage');
      moveVirus(virus);
    }

    function moveVirus(virus) {
      const startTime = parseFloat(virus.dataset.startTime);
      const elapsed = (Date.now() - startTime) / 1000;
      const progress = Math.min(elapsed * virusSpeed, 1);
      const dx = parseFloat(virus.style.getPropertyValue('--dx'));
      const dy = parseFloat(virus.style.getPropertyValue('--dy'));
      virus.style.transform = `translate(${dx * progress}px, ${dy * progress}px)`;
      if (progress >= 1) {
        const x = parseFloat(virus.style.left) + dx;
        const y = parseFloat(virus.style.top) + dy;
        const damage = virus.dataset.type === 'ü¶†' ? 10 : virus.dataset.type === 'üíæ' ? 20 : 15;
        health -= damage;
        createParticles(x, y);
        updateHealth();
        virus.remove();
        logToConsole(`Damage: ${damage} HP (${virus.dataset.type})`, 'damage');
      } else {
        requestAnimationFrame(() => moveVirus(virus));
      }
    }

    function enemyAttack() {
      enemyTimer--;
      const enemyTimerDisplay = document.getElementById('enemyTimer');
      if (enemyTimerDisplay) {
        enemyTimerDisplay.innerHTML = `Virus hujumi: <progress max="20" value="${enemyTimer}"></progress>`;
      }
      if (enemyTimer <= 0) {
        createVirus();
        enemyTimer = 20;
      }
    }

    function startCodeGeneration() {
      if (gameOver) return;
      createCode();
      setTimeout(startCodeGeneration, Math.random() * 2000 + 1000);
    }

    function startEnemyLoop() {
      if (!enemyInterval) {
        enemyInterval = setInterval(() => {
          if (!gameOver) {
            enemyAttack();
          }
        }, 1000);
      }
    }

    function stopEnemyLoop() {
      if (enemyInterval) {
        clearInterval(enemyInterval);
        enemyInterval = null;
      }
    }

    function restartGame() {
      stopEnemyLoop();
      stopManaRegeneration();
      initializeGame();
    }

    window.onload = function() {
      initializeGame();
      const wordInput = document.getElementById('wordInput');
      const restartButton = document.getElementById('restartButton');
      const surgeSkill = document.getElementById('surgeSkill');
      const shieldBoostSkill = document.getElementById('shieldBoostSkill');
      const debugSkill = document.getElementById('debugSkill');
      if (wordInput) wordInput.addEventListener('input', checkCode);
      if (restartButton) restartButton.addEventListener('click', restartGame);
      if (surgeSkill) surgeSkill.addEventListener('click', useSurge);
      if (shieldBoostSkill) shieldBoostSkill.addEventListener('click', useShieldBoost);
      if (debugSkill) debugSkill.addEventListener('click', useDebug);
    };
  </script>
</body>
</html>